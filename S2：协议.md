# Beanstalkd 自定义协议介绍

[TOC]

Beanstalkd 是基于 TCP 的 ASCLL 编码协议， 客户端在连接服务端后发送数据和指令，并在接收响应之后关闭连接。对于每个连接，服务端按照接收到的命令序列依次处理并且依次响应。除特别声明外，所有整数型数字在协议中都被定义为非负的十进制。

## 命名约定

在本协议中，所有的命名都是 ASCLL 编码，即包括以下字符：

- 字母（A-Z 和 a-z）
- 数字（0-9）
- 连字符 ("-")
- 加号 ("+")
- 斜线 ("/")
- 分号 (";")
- 点 (".")
- 美元符 ("$")
- 下划线 ("_")
- 括号 ("(" and ")")

具体请查 ASCLL 字码表。

**需要注意的是**：命名不能以 - 起头和 空格结尾，命名至少要一个字符长度

## 数据类型

该协议中的数据类型有两种：单行字符串和非结构化的整块数据。

单行字串：用于描述客户端请求指令和服务端响应状态。
块数据：指任务实体和状态信息。

任务实体包含的是不透明的字节序列，服务端不会对实体做任何的检查和修改，只会原样的返回给客户端。任务实体的具体意义或行为都由客户端去定义和理解。

## connect

如果客户端不再被使用了，可以通过提交 quit 命令或者直接断开 TCP 连接的方式来解除和服务端的连接。

Beanstalkd 可以同时支持大量长连接，所以建议对一个客户端应该尽可能的保持连接来重复使用而不是每次重新建立TCP连接的方式。

## 错误状态码

如果客户端违反了协议（如发送了违反约定的请求体或者不存在的命令），或者服务端发生了错误，那么服务端将会发送下面的某个错误信息：

    - "OUT_OF_MEMORY\r\n" : 内存不足
    - "INTERNAL_ERROR\r\n" : 产生了一个不该发生的服务端bug，可以将错误报告发送给[http://groups.google.com/group/beanstalk-talk.
    ](http://groups.google.com/group/beanstalk-talk.
    )
    - "BAD_FORMAT\r\n": 客户端发送了非法的请求体
    - "UNKNOWN_COMMAND\r\n"：客户端发送了不存在的命令

在下面的具体指令描述中将不会列出这些 error，但是这些 error 状态实际包含在所有的指令中，客户端应该对于任何指令都应该做好处理这些 error 的准备

## 任务的生命周期